<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Verification Required | AcademicAssistPro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- jsPDF and html2canvas libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #ffb347;
            --danger: #ff6b6b;
            --light: #f8f9fa;
            --dark: #1a1a2e;
            --darker: #16213e;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.2);
            --radius: 10px;
            --radius-lg: 16px;
            --transition: all 0.25s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0a0a2e 0%, #1a1a40 100%);
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .status-header {
            text-align: center;
            padding: 60px 0 40px;
            position: relative;
            overflow: hidden;
        }

        .status-header::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.05) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-header h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            background: linear-gradient(45deg, #fff 30%, #4cc9f0 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .status-header h1 i {
            margin-right: 15px;
        }

        .status-header p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Status Card */
        .status-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 50px;
            margin: 40px auto;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(67, 97, 238, 0.05), transparent 70%);
            z-index: 0;
        }

        .status-icon {
            font-size: 5rem;
            color: var(--warning);
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .status-card h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: #fff;
            position: relative;
            z-index: 1;
        }

        .status-card p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            line-height: 1.8;
        }

        /* PDF Preview Section */
        .pdf-preview {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            color: #333;
            position: relative;
        }

        .pdf-header {
            border-bottom: 3px solid #4361ee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .pdf-header h2 {
            color: #1a1a2e;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .pdf-header .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .pdf-content {
            padding: 20px 0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4361ee;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            color: #1a1a2e;
            font-weight: 600;
        }

        .important-note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .important-note h4 {
            color: #856404;
            margin-bottom: 10px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .important-note ul {
            padding-left: 20px;
            color: #856404;
        }

        .important-note li {
            margin-bottom: 8px;
        }

        .signature-section {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
            text-align: center;
        }

        .signature-box {
            display: inline-block;
            padding: 20px;
            text-align: center;
        }

        .signature-line {
            width: 300px;
            border-bottom: 2px solid #4361ee;
            margin: 30px auto 10px;
        }

        /* Payment Notice Box */
        .payment-notice {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin: 30px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease 0.3s forwards;
            opacity: 0;
        }

        .payment-notice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(220, 53, 69, 0.05), transparent 70%);
            z-index: 0;
        }

        .payment-notice h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ff6b6b;
            position: relative;
            z-index: 1;
        }

        .payment-notice h3 i {
            margin-right: 10px;
        }

        .payment-notice p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            line-height: 1.6;
        }

        /* Request Info */
        .request-info {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 30px 0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .request-info {
                grid-template-columns: 1fr;
            }
        }

        /* Timeline */
        .timeline {
            margin: 50px 0;
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }

        .timeline-item {
            display: flex;
            align-items: flex-start;
            gap: 25px;
            margin-bottom: 40px;
            position: relative;
            padding-left: 30px;
        }

        .timeline-item.active .timeline-number {
            background: linear-gradient(135deg, var(--danger), var(--accent));
            border-color: var(--danger);
            box-shadow: 0 0 20px rgba(220, 53, 69, 0.3);
        }

        .timeline-item.completed .timeline-number {
            background: linear-gradient(135deg, var(--success), #10b981);
            border-color: var(--success);
        }

        .timeline-item.pending .timeline-number {
            background: linear-gradient(135deg, var(--warning), #ff9e00);
            border-color: var(--warning);
        }

        .timeline-number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            transition: var(--transition);
        }

        .timeline-content {
            flex: 1;
            padding-top: 10px;
        }

        .timeline-content h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.4rem;
            margin-bottom: 8px;
            color: #fff;
        }

        .timeline-content p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* Contact Info */
        .contact-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-top: 40px;
            text-align: center;
        }

        .contact-box h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--success);
        }

        .contact-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .contact-details {
                grid-template-columns: 1fr;
            }
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .contact-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .contact-item i {
            color: var(--primary);
            font-size: 1.3rem;
            width: 30px;
        }

        .contact-item span {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        /* Buttons */
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 35px;
            border-radius: var(--radius);
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff9e00);
            color: #1a1a2e;
            font-weight: 700;
        }

        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 179, 71, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #10b981);
            color: white;
            font-weight: 700;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(76, 201, 240, 0.3);
        }

        /* Resubmission Instructions */
        .resubmission-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin: 40px 0;
            text-align: center;
        }

        .resubmission-info h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #ffc107;
        }

        .resubmission-info h3 i {
            margin-right: 10px;
        }

        .resubmission-steps {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        @media (max-width: 768px) {
            .resubmission-steps {
                grid-template-columns: 1fr;
            }
        }

        .step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 25px 20px;
            text-align: center;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--warning), #ff9e00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: 700;
            color: #1a1a2e;
        }

        .step h4 {
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 10px;
            color: #fff;
        }

        .step p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }

        /* Footer */
        .status-footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-footer p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* PDF Loading Overlay */
        .pdf-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .pdf-loading.active {
            opacity: 1;
            pointer-events: all;
        }

        .pdf-loading i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pdf-loading p {
            color: white;
            font-size: 1.2rem;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 20px 15px;
            }
            
            .status-header {
                padding: 40px 0 30px;
            }
            
            .status-header h1 {
                font-size: 2.3rem;
            }
            
            .status-header p {
                font-size: 1rem;
            }
            
            .status-card {
                padding: 30px 20px;
            }
            
            .status-icon {
                font-size: 4rem;
            }
            
            .status-card h2 {
                font-size: 1.8rem;
            }
            
            .timeline::before {
                left: 20px;
            }
            
            .timeline-item {
                padding-left: 20px;
            }
            
            .timeline-number {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- PDF Loading Overlay -->
    <div class="pdf-loading" id="pdfLoading">
        <i class="fas fa-spinner"></i>
        <p>Generating PDF...</p>
        <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">This may take a few moments</p>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="status-header">
            <h1><i class="fas fa-tasks"></i> Request Status</h1>
            <p>Track the progress of your request and take necessary actions</p>
        </header>

        <!-- Status Card -->
        <div class="status-card">
            <div class="status-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Action Required: Proof of Payment Needed</h2>
            <p>We were unable to verify your payment details. <strong>You will be contacted by our team</strong> and requested to submit proof of payment again.</p>
            <p><strong>Important:</strong> Your request will remain on hold until valid payment verification is received.</p>
        </div>

        <!-- PDF Preview Section -->
       

        <!-- Payment Notice -->
        <div class="payment-notice">
            <h3><i class="fas fa-money-check-alt"></i> Payment Verification Required</h3>
            <p><strong>Our team will contact you shortly</strong> to request a valid proof of payment. This is necessary to proceed with your assignment request.</p>
            
            <div class="important-note" style="background: rgba(255,255,255,0.05); border-color: rgba(255,193,7,0.5);">
                <h4 style="color: #ffc107;"><i class="fas fa-info-circle"></i> Important: Download PDF Notice</h4>
                <p style="color: rgba(255,255,255,0.9);">Keep a copy of the PDF notice above for your records. You may need to present it when contacted by our team.</p>
            </div>
        </div>

        

        <!-- Progress Timeline -->
        <div class="timeline">
            <div class="timeline-item completed">
                <div class="timeline-number">1</div>
                <div class="timeline-content">
                    <h3>Request Submitted</h3>
                    <p>Your request details have been received and logged.</p>
                </div>
            </div>

            <div class="timeline-item active">
                <div class="timeline-number">2</div>
                <div class="timeline-content">
                    <h3>Payment Verification</h3>
                    <p><strong>Action Required:</strong> Our team will contact you to request valid payment proof.</p>
                </div>
            </div>

            <div class="timeline-item pending">
                <div class="timeline-number">3</div>
                <div class="timeline-content">
                    <h3>Expert Assignment</h3>
                    <p>Will proceed once payment is verified and confirmed.</p>
                </div>
            </div>

            <div class="timeline-item pending">
                <div class="timeline-number">4</div>
                <div class="timeline-content">
                    <h3>Work in Progress</h3>
                    <p>Our expert will begin working after payment confirmation.</p>
                </div>
            </div>

            <div class="timeline-item pending">
                <div class="timeline-number">5</div>
                <div class="timeline-content">
                    <h3>Quality Check</h3>
                    <p>Quality assurance after completion.</p>
                </div>
            </div>

            <div class="timeline-item pending">
                <div class="timeline-number">6</div>
                <div class="timeline-content">
                    <h3>Delivery</h3>
                    <p>Delivery of completed work before deadline.</p>
                </div>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="contact-box">
            <h3><i class="fas fa-headset"></i> Contact for Assistance</h3>
            <p>If you haven't been contacted within 2 hours, please reach out:</p>
            
            <div class="contact-details">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>+27 12 345 6789</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-whatsapp"></i>
                    <span>+27 12 345 6789 (WhatsApp)</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>payments@academicassistpro.com</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-clock"></i>
                    <span>Mon-Fri: 8AM-6PM | Sat: 9AM-1PM</span>
                </div>
            </div>
            
            <p style="margin-top: 25px; color: rgba(255,255,255,0.6); font-size: 0.95rem;">
                <i class="fas fa-info-circle"></i> When contacting us, please mention your request ID for faster assistance.
            </p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="/" class="btn btn-primary">
                <i class="fas fa-home"></i> Back to Home
            </a>
            <button class="btn btn-success" id="generatePDF">
                <i class="fas fa-file-pdf"></i> Generate PDF Notice
            </button>
            <a href="mailto:payments@academicassistpro.com?subject=Payment%20Proof%20Resubmission%20-%20Request%20ID%3A%20%23{{ request_id }}" 
               class="btn btn-warning">
                <i class="fas fa-paper-plane"></i> Send Payment Proof Now
            </a>
        </div>

        <!-- Footer -->
        <footer class="status-footer">
            <p>© 2025 AcademicAssistPro — All rights reserved. | Request ID: #{{ request_id }}</p>
            <p style="margin-top: 10px; font-size: 0.9rem; color: rgba(255,255,255,0.5);">
                <i class="fas fa-shield-alt"></i> Secure & Confidential Service
            </p>
        </footer>
    </div>

    <script>
        // Initialize animations
        document.addEventListener('DOMContentLoaded', function () {
            // Add staggered animation to timeline items
            const timelineItems = document.querySelectorAll('.timeline-item');
            timelineItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(-20px)';
                
                setTimeout(() => {
                    item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateX(0)';
                }, index * 200);
            });
            
            // Animate status card
            const statusCard = document.querySelector('.status-card');
            statusCard.style.opacity = '0';
            setTimeout(() => {
                statusCard.style.opacity = '1';
            }, 100);
            
            // Animate payment notice
            const paymentNotice = document.querySelector('.payment-notice');
            setTimeout(() => {
                paymentNotice.style.opacity = '1';
            }, 200);
            
            // Animate request info
            const infoItems = document.querySelectorAll('.info-item');
            infoItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, 600 + (index * 100));
            });
        });

        // PDF Generation Function
        document.getElementById('generatePDF').addEventListener('click', async function(e) {
            e.preventDefault();
            
            const pdfLoading = document.getElementById('pdfLoading');
            pdfLoading.classList.add('active');
            
            try {
                // Wait a moment for the loading screen to show
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Capture the PDF content
                const pdfContent = document.getElementById('pdfContent');
                
                // Get current date for filename
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Set document properties
                doc.setProperties({
                    title: `Payment Verification Notice - Request #{{ request_id }}`,
                    subject: 'Payment Verification Required',
                    author: 'AcademicAssistPro',
                    keywords: 'payment, verification, notice, academic',
                    creator: 'AcademicAssistPro System'
                });
                
                // Add watermark
                doc.setTextColor(200, 200, 200);
                doc.setFontSize(60);
                doc.text('VERIFICATION', 105, 140, { angle: 45, align: 'center' });
                doc.setTextColor(0, 0, 0);
                
                // Capture content as image
                const canvas = await html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                // Calculate dimensions for A4
                const imgWidth = 210; // A4 width in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Add image to PDF
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                
                // Add page number
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Page 1 of 1`, 200, 290, { align: 'right' });
                
                // Add generation timestamp
                doc.text(`Generated: ${now.toLocaleString()}`, 10, 290);
                
                // Save the PDF
                doc.save(`Payment_Verification_Notice_{{ request_id }}_${dateStr}_${timeStr}.pdf`);
                
                // Show success message
                setTimeout(() => {
                    alert('PDF generated successfully! The document has been downloaded.');
                }, 500);
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                pdfLoading.classList.remove('active');
            }
        });

        // Alternative: Generate text-based PDF (simpler version)
        function generateTextPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const now = new Date();
            const requestId = "{{ request_id }}";
            
            // Add header
            doc.setFontSize(20);
            doc.setTextColor(67, 97, 238);
            doc.text('AcademicAssistPro', 105, 20, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Payment Verification Notice', 105, 30, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text(`Request ID: #${requestId}`, 105, 40, { align: 'center' });
            
            // Add separator
            doc.setLineWidth(0.5);
            doc.line(20, 45, 190, 45);
            
            // Add content
            doc.setFontSize(11);
            let yPos = 55;
            
            doc.text(`Date: ${now.toLocaleDateString()}`, 20, yPos);
            doc.text(`Time: ${now.toLocaleTimeString()}`, 150, yPos);
            yPos += 15;
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('IMPORTANT NOTICE:', 20, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            const noticeText = `This document confirms that you will be contacted by our support team to request valid proof of payment for Request ID #${requestId}.`;
            doc.text(noticeText, 20, yPos, { maxWidth: 170 });
            yPos += 20;
            
            doc.setFont(undefined, 'bold');
            doc.text('Why is this required?', 20, yPos);
            yPos += 10;
            
            doc.setFont(undefined, 'normal');
            const reasons = [
                'The provided payment proof was unclear or incomplete',
                'Payment details do not match our records',
                'Transaction amount doesn\'t match the invoice',
                'Missing transaction timestamp or reference number',
                'Account holder name doesn\'t match your details'
            ];
            
            reasons.forEach(reason => {
                doc.text(`• ${reason}`, 25, yPos, { maxWidth: 165 });
                yPos += 8;
            });
            
            yPos += 10;
            
            // Add footer
            doc.setLineWidth(0.3);
            doc.line(20, 250, 190, 250);
            
            doc.setFontSize(10);
            doc.text('© 2025 AcademicAssistPro. All rights reserved.', 105, 260, { align: 'center' });
            doc.text('payments@academicassistpro.com | +27 12 345 6789', 105, 265, { align: 'center' });
            doc.text(`Document Reference: PAY-VERIFY-${requestId}-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}`, 105, 270, { align: 'center' });
            
            // Save the PDF
            doc.save(`Payment_Notice_${requestId}.pdf`);
        }

        // Auto-refresh reminder
        setTimeout(() => {
            if (confirm('Your request is still awaiting payment verification. Would you like to refresh the page to check for updates?')) {
                location.reload();
            }
        }, 10 * 60 * 1000); // 10 minutes
    </script>
</body>
</html>